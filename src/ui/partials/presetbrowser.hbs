<div
  x-data="presetBrowser()"
  class="bg-neutral-700 text-white font-bold select-none !cursor-default h-full overflow-hidden"
>
  <div class="m-[2px] h-full flex flex-col">
    <div class="text-white text-xs flex items-center justify-between px-2 py-1">
      <div class="font-semibold tracking-wide uppercase">Presets</div>
      <div class="flex items-center gap-1">
        <button
          @click="refreshPresets()"
          class="p-1 hover:opacity-60"
          aria-label="Refresh preset list"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 16 16"
            fill="currentColor"
            class="size-3"
            :class="getRoot()?.isScanningPresets ? 'animate-spin' : ''"
          >
            <path
              fill-rule="evenodd"
              d="M13.836 2.477a.75.75 0 0 1 .75.75v3.182a.75.75 0 0 1-.75.75h-3.182a.75.75 0 0 1 0-1.5h1.37l-.84-.841a4.5 4.5 0 0 0-7.08.932.75.75 0 0 1-1.3-.75 6 6 0 0 1 9.44-1.242l.842.84V3.227a.75.75 0 0 1 .75-.75Zm-.911 7.5A.75.75 0 0 1 13.199 11a6 6 0 0 1-9.44 1.241l-.84-.84v1.371a.75.75 0 0 1-1.5 0V9.591a.75.75 0 0 1 .75-.75H5.35a.75.75 0 0 1 0 1.5H3.98l.841.841a4.5 4.5 0 0 0 7.08-.932.75.75 0 0 1 1.025-.273Z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
        <button
          @click="getRoot()?.togglePresetBrowser()"
          class="p-1 -mr-1.5 hover:opacity-60"
          aria-label="Close preset browser"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 16 16"
            fill="currentColor"
            class="size-4"
          >
            <path
              d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"
            />
          </svg>
        </button>
      </div>
    </div>

    <div class="p-2 flex flex-col gap-2 grow overflow-hidden">
      <input
        x-model="searchTerm"
        type="text"
        placeholder="Search presets..."
        autocomplete="off"
        class="shrink-0 h-10 font-semibold px-2 text-xs border-2 border-black bg-black text-white outline-none"
      />

      <div class="flex flex-wrap gap-1" aria-label="Preset tags">
        <template x-if="availableTags.length === 0">
          <div class="text-[10px] text-white text-opacity-50">
            No tags available
          </div>
        </template>

        <template x-for="tag in availableTags" :key="tag">
          <button
            @click="toggleTag(tag)"
            class="px-2 py-1 text-[10px] uppercase tracking-widest hover:bg-white hover:bg-opacity-20"
            :class="selectedTags.has(tag) ? 'bg-white text-black' : 'bg-black text-white'"
            x-text="tag"
          ></button>
        </template>
      </div>

      <div
        class="bg-black scrollbar-none text-white grow overflow-y-auto overflow-x-hidden gap-0.5 py-1 flex flex-col items-stretch text-xs"
        aria-label="Preset list"
      >
        <template x-if="filteredPresets.length === 0">
          <div class="px-2 py-2 text-black text-opacity-50">
            No presets found
          </div>
        </template>

        <template
          x-for="(preset, index) in filteredPresets"
          :key="preset.index"
        >
          <button
            @click="loadPreset(preset.index)"
            @keydown.down.prevent="navigateDown(index)"
            @keydown.up.prevent="navigateUp(index)"
            tabindex="0"
            class="mx-1 text-left break-all text-white text-[10px] tracking-wider px-0.5 py-1"
            :class="preset.index === getRoot()?.currentPresetIndex ? 'bg-white !bg-opacity-30' : 'bg-black'"
          >
            <div
              class="text-[8px] -mb-0.5 font-medium text-white tracking-wide text-opacity-70"
              x-text="getPresetPrefix(preset.displayName)"
            ></div>
            <div x-text="getPresetName(preset.displayName)"></div>
          </button>
        </template>
      </div>
    </div>
  </div>
</div>